<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الموسوعة الكبرى لتفسير الأحلام</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --dark-royal: #050c1a; --gold-leaf: #c5a059; --accent-gold: #d4af37; --bg-soft: #f8f9fa; }
        body { background-color: var(--bg-soft); font-family: 'Tajawal', sans-serif; color: var(--dark-royal); margin: 0; }
        .royal-header { background: linear-gradient(135deg, #050c1a 0%, #0f172a 100%); color: white; padding: 60px 20px; text-align: center; border-bottom: 4px solid var(--gold-leaf); }
        .royal-header h1 { font-family: 'Amiri', serif; font-size: 2.8rem; font-weight: 700; color: var(--accent-gold); margin-bottom: 10px; }
        .search-section { max-width: 650px; margin: -35px auto 30px; padding: 0 20px; }
        .search-bar { border-radius: 50px !important; padding: 18px 30px !important; border: 2px solid var(--gold-leaf) !important; font-size: 1.3rem !important; box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important; text-align: center; }
        .ad-wrap { max-width: 100%; margin: 15px auto; min-height: 90px; background: rgba(0,0,0,0.02); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .main-content { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 40px; }
        .nav-tabs-royal { border: none !important; display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        .nav-link { border: 2px solid #f0f0f0 !important; border-radius: 50px !important; color: var(--dark-royal) !important; font-weight: 700; padding: 8px 20px !important; background: #fff; cursor: pointer; }
        .nav-link.active { background: var(--dark-royal) !important; color: var(--accent-gold) !important; border-color: var(--dark-royal) !important; }
        .interpretation-display { font-family: 'Amiri', serif; font-size: 1.7rem; line-height: 1.8; color: #2d3436; padding: 25px; background: #fffdf9; border-right: 6px solid var(--gold-leaf); border-radius: 8px; min-height: 200px; }
        .mufasir-label { font-size: 1rem; color: var(--gold-leaf); font-weight: 900; margin-bottom: 15px; display: block; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
        footer { background: #050c1a; color: #555; padding: 20px; text-align: center; border-top: 3px solid var(--gold-leaf); }
    </style>
</head>
<body>

<div class="ad-wrap"></div>

<header class="royal-header">
    <h1>الموسوعة الكبرى لتفسير الأحلام</h1>
    <p>بوابتك الموثوقة لفك رموز الرؤى والمنامات</p>
</header>

<div class="search-section">
    <input type="text" id="searchInput" class="form-control search-bar" placeholder="رؤيا...">
</div>

<div class="container">
    <div class="main-content">
        <ul class="nav nav-pills nav-tabs-royal">
            <li class="nav-item"><button id="btn-sirin" class="nav-link active" onclick="changeSource('sirin')">ابن سيرين</button></li>
            <li class="nav-item"><button id="btn-nabulsi" class="nav-link" onclick="changeSource('nabulsi')">النابلسي</button></li>
            <li class="nav-item"><button id="btn-shahin" class="nav-link" onclick="changeSource('shahin')">ابن شاهين</button></li>
        </ul>

        <div id="displayArea">
            <span id="mufasirTitle" class="mufasir-label">مجلد الإمام ابن سيرين</span>
            <div id="resultText" class="interpretation-display">
                <p class="text-center text-muted" style="font-family:Tajawal; font-size:1rem; padding-top:40px;">اكتب الكلمة الأساسية للرؤيا لبدء البحث..</p>
            </div>
        </div>
    </div>
</div>

<footer><p>© 2026 الموسوعة الكبرى لتفسير الأحلام</p></footer>

<script>
    let currentSource = 'sirin';
    let data = { sirin: [], nabulsi: [], shahin: [] };

    async function loadData() {
        // إضافة v= لضمان جلب أحدث ملفات JSON من السيرفر
        const v = Date.now();
        try {
            const [s, n, h] = await Promise.all([
                fetch(`data_sirin.json?v=${v}`).then(r => r.json()),
                fetch(`data_nabulsi.json?v=${v}`).then(r => r.json()),
                fetch(`data_shahin.json?v=${v}`).then(r => r.json())
            ]);
            data = { sirin: s, nabulsi: n, shahin: h };
            console.log("تم تحديث كافة المجلدات");
        } catch (e) { console.error("خطأ في تحميل البيانات"); }
    }

    function changeSource(src) {
        currentSource = src;
        document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + src).classList.add('active');
        
        const titles = { sirin: 'مجلد الإمام ابن سيرين', nabulsi: 'مجلد الشيخ النابلسي', shahin: 'مجلد العالم ابن شاهين' };
        document.getElementById('mufasirTitle').innerText = titles[src];
        search();
    }

    function clean(t) {
        return t ? t.replace(/^ال/, "").replace(/[أإآا]/g, "ا").replace(/ة/g, "ه").trim() : "";
    }

    function search() {
        const query = document.getElementById('searchInput').value.trim();
        const resDiv = document.getElementById('resultText');
        
        if (!query) {
            resDiv.innerHTML = '<p class="text-center text-muted" style="font-family:Tajawal; font-size:1rem; padding-top:40px;">اكتب الكلمة الأساسية للرؤيا لبدء البحث..</p>';
            return;
        }

        const cleanQuery = clean(query);
        const found = data[currentSource].find(item => clean(item.word) === cleanQuery || item.word.includes(query));
        
        // مسح المحتوى القديم تماماً قبل إضافة الجديد (لحل مشكلة التداخل)
        resDiv.innerHTML = ""; 

        if (found) {
            resDiv.innerHTML = `<div style="color:var(--dark-royal); font-weight:bold; margin-bottom:10px; border-bottom: 2px solid var(--gold-leaf); display:inline-block;">تفسير رمز (${query}):</div><br>${found.interpretation}`;
        } else {
            resDiv.innerHTML = `<p class="text-center text-danger" style="font-family:Tajawal; font-size:1.1rem; padding-top:40px;">عذراً، هذا الرمز غير متوفر حالياً في هذا المجلد.</p>`;
        }
    }

    document.getElementById('searchInput').addEventListener('input', search);
    window.onload = loadData;
</script>
</body>
</html>





