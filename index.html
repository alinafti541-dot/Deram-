<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الموسوعة الكبرى لتفسير الأحلام</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky-blue: #e3f2fd;
            --ocean-blue: #0288d1;
            --royal-blue: #01579b;
            --accent-gold: #ffd700;
            --text-dark: #1a2a3a;
        }
        
        body {
            background-color: var(--sky-blue);
            font-family: 'Tajawal', sans-serif;
            color: var(--text-dark);
            margin: 0;
            overflow-x: hidden;
        }

        /* مساحة الإعلان العلوية */
        .top-ad-banner {
            background: #ffffff;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid rgba(2, 136, 209, 0.1);
            font-size: 0.85rem;
            color: #aaa;
        }

        /* الهيدر الاحترافي */
        .main-header {
            background: linear-gradient(135deg, var(--royal-blue) 0%, var(--ocean-blue) 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
        }

        .main-header h1 {
            font-family: 'Amiri', serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .main-header p {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* صندوق البحث والمفسر */
        .search-container {
            max-width: 800px;
            margin: -40px auto 40px;
            padding: 0 20px;
        }

        .search-card {
            background: white;
            border-radius: 25px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 15px 35px rgba(1, 87, 155, 0.15);
            border: 1px solid rgba(2, 136, 209, 0.1);
        }

        .input-group-custom {
            display: flex;
            background: #f8f9fa;
            border-radius: 20px;
            padding: 5px;
            margin-bottom: 10px;
        }

        .input-group-custom input {
            border: none;
            background: transparent;
            padding: 15px 25px;
            width: 100%;
            font-size: 1.2rem;
            outline: none;
        }

        .action-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-interpret {
            background: var(--ocean-blue);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-weight: 700;
            transition: 0.3s;
        }

        .btn-interpret:hover {
            background: var(--royal-blue);
            transform: translateY(-2px);
        }

        .btn-search {
            background: #ffffff;
            color: var(--ocean-blue);
            border: 2px solid var(--ocean-blue);
            padding: 15px;
            border-radius: 15px;
            font-weight: 700;
        }

        /* منطقة النتائج */
        .result-section {
            background: white;
            border-radius: 30px;
            padding: 40px;
            min-height: 400px;
            margin-bottom: 50px;
            border: 1px solid rgba(2, 136, 209, 0.05);
        }

        .interpretation-title {
            font-family: 'Amiri', serif;
            color: var(--royal-blue);
            border-right: 5px solid var(--ocean-blue);
            padding-right: 15px;
            margin-bottom: 25px;
        }

        .interpretation-content {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            line-height: 1.9;
            color: #333;
            text-align: justify;
        }

        .nav-pills .nav-link {
            color: var(--ocean-blue);
            font-weight: 600;
            border-radius: 12px;
            margin: 0 5px;
        }

        .nav-pills .nav-link.active {
            background-color: var(--ocean-blue) !important;
        }

        .loader { display: none; text-align: center; color: var(--ocean-blue); }

    </style>
</head>
<body>

<div class="top-ad-banner">
    <span>مساحة إعلانية موصى بها</span>
</div>

<header class="main-header">
    <div class="container">
        <h1>موسوعة أئمة التفسير</h1>
        <p>المرجع الأصيل لتفسير الرؤى والمنامات وفق ضوابط الشريعة</p>
    </div>
</header>

<div class="container search-container">
    <div class="search-card">
        <div class="input-group-custom">
            <input type="text" id="userInput" placeholder="اكتب حلمك بالتفصيل أو ابحث عن رمز معين...">
        </div>
        <div class="action-btns">
            <button class="btn-interpret" onclick="interpretNow()"><i class="fas fa-feather-alt"></i> تفسير فوري عميق</button>
            <button class="btn-search" onclick="searchInBooks()"><i class="fas fa-book"></i> بحث في المجلدات</button>
        </div>
    </div>
</div>

<div class="container">
    <div class="result-section">
        <ul class="nav nav-pills justify-content-center mb-5" id="sourceTabs">
            <li class="nav-item"><button class="nav-link active" onclick="setSource('sirin')">ابن سيرين</button></li>
            <li class="nav-item"><button class="nav-link" onclick="setSource('nabulsi')">النابلسي</button></li>
            <li class="nav-item"><button class="nav-link" onclick="setSource('shahin')">ابن شاهين</button></li>
        </ul>

        <div id="loader" class="loader">
            <i class="fas fa-compass fa-spin fa-3x"></i>
            <p class="mt-3">جاري استحضار أقوال العلماء...</p>
        </div>

        <div id="displayArea" class="interpretation-content">
            <div class="text-center opacity-25">
                <i class="fas fa-book-open fa-4x mb-4"></i>
                <p>بإمكانك كتابة الحلم كاملاً للحصول على تحليل مفصل من المصادر الموثوقة</p>
            </div>
        </div>
    </div>
</div>

<script>
    let currentSource = 'sirin';
    let data = { sirin: [], nabulsi: [], shahin: [] };

    // تحميل البيانات الأصلية
    async function init() {
        try {
            const [s, n, h] = await Promise.all([
                fetch('data_sirin.json').then(r => r.json()),
                fetch('data_nabulsi.json').then(r => r.json()),
                fetch('data_shahin.json').then(r => r.json())
            ]);
            data = { sirin: s, nabulsi: n, shahin: h };
        } catch (e) { console.log("تحميل المجلدات..."); }
    }

    function setSource(src) {
        currentSource = src;
        document.querySelectorAll('#sourceTabs .nav-link').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }

    // الطريقة الأولى: البحث المباشر في الكتب
    function searchInBooks() {
        const query = document.getElementById('userInput').value;
        const area = document.getElementById('displayArea');
        if(!query) return;

        const results = data[currentSource].filter(i => (i.word || i.كلمة || "").includes(query));
        
        if(results.length > 0) {
            area.innerHTML = results.map(r => `
                <div class="mb-5">
                    <h2 class="interpretation-title">تفسير رمز: ${r.word || r.كلمة}</h2>
                    <p>${r.interpretation || r.تفسير}</p>
                </div>
            `).join('');
        } else {
            area.innerHTML = "<div class='text-center'>لم نجد هذا الرمز في المجلد المختار، جرب زر 'التفسير الفوري'.</div>";
        }
    }

    // الطريقة الثانية: التفسير العميق (AI)
    async function interpretNow() {
        const text = document.getElementById('userInput').value;
        const area = document.getElementById('displayArea');
        const loader = document.getElementById('loader');
        const apiKey = "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";

        if(!text) return;
        
        area.style.display = 'none';
        loader.style.display = 'block';

        try {
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${apiKey}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "model": "google/gemini-2.0-flash-lite-preview-02-05:free",
                    "messages": [
                        {
                            "role": "system", 
                            "content": "أنت عالم خبير في تأويل الرؤى، تعتمد حصراً على منهج ابن سيرين والنابلسي. قدم التفسير بأسلوب لغوي رصين وفخم، مبتعداً عن المصطلحات التقنية. ابدأ التفسير بذكر الرموز وما تعنيه عند العلماء."
                        },
                        {"role": "user", "content": `فسر لي هذا الحلم: ${text}`}
                    ]
                })
            });

            const result = await response.json();
            const content = result.choices[0].message.content;

            loader.style.display = 'none';
            area.style.display = 'block';
            area.innerHTML = `
                <h2 class="interpretation-title">النتيجة المستخلصة من أمهات الكتب</h2>
                <div class="interpretation-content">${content.replace(/\n/g, '<br>')}</div>
            `;
        } catch (e) {
            loader.style.display = 'none';
            area.style.display = 'block';
            area.innerHTML = "تعذر الاتصال بالمفسر حالياً، يرجى المحاولة لاحقاً.";
        }
    }

    window.onload = init;
</script>
</body>
</html>
