// دالة الربط مع الذكاء الاصطناعي
async function askAI() {
    const userDream = document.getElementById('searchInput').value;
    const resultArea = document.getElementById('resultArea');
    const apiKey = "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";

    if (!userDream) {
        alert("الرجاء كتابة الحلم أولاً");
        return;
    }

    resultArea.innerHTML = "جاري الاتصال بالمفسر الذكي... <i class='fas fa-magic fa-spin'></i>";

    try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${apiKey}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "model": "google/gemini-2.0-flash-lite-preview-02-05:free", // نموذج مجاني سريع
                "messages": [
                    {
                        "role": "system", 
                        "content": "أنت مفسر أحلام خبير. فسر الحلم بناءً على منهج ابن سيرين والنابلسي. كن موجزاً وواضحاً."
                    },
                    {"role": "user", "content": userDream}
                ]
            })
        });

        const data = await response.json();
        const aiResponse = data.choices[0].message.content;

        resultArea.innerHTML = `
            <div class='ai-response'>
                <h4 style='color: #d4af37;'><i class='fas fa-robot'></i> تفسير الذكاء الاصطناعي:</h4>
                <p>${aiResponse}</p>
                <small style='color: gray;'>* التفسير تم توليده آلياً بناءً على رموز الحلم.</small>
            </div>
        `;

    } catch (error) {
        resultArea.innerHTML = "حدث خطأ في الاتصال بالمفسر. تأكد من صلاحية المفتاح.";
        console.error(error);
    }
}
