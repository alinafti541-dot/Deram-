<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مفسر الأحلام الذكي - تفسير الأحلام بالذكاء الاصطناعي</title>
    
    <!-- الخطوط العربية -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Almarai:wght@300;400;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #10a37f;
            --primary-dark: #0d8a6b;
            --primary-light: #d1f7ed;
            --secondary-color: #5436da;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --text-light: #64748b;
            --border-color: #e2e8f0;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --hover-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Almarai', 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Amiri', serif;
            font-weight: 700;
            color: var(--text-color);
        }
        
        /* هيدر الموقع */
        .site-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 40px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .site-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white" opacity="0.05"/></svg>');
            background-size: cover;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .ai-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            margin-top: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* قسم تفسير الأحلام */
        .interpretation-section {
            margin-top: -30px;
            position: relative;
            z-index: 10;
        }
        
        .dream-form {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }
        
        .form-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .form-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
        }
        
        .dream-input {
            width: 100%;
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 150px;
        }
        
        .dream-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }
        
        .interpret-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            width: 100%;
        }
        
        .interpret-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .interpret-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* أمثلة سريعة */
        .quick-examples {
            margin-top: 30px;
        }
        
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .example-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--card-shadow);
        }
        
        .example-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        /* نتائج التفسير */
        .results-section {
            margin-top: 40px;
        }
        
        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            display: none;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .result-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .result-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }
        
        .dream-text {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border-right: 4px solid var(--primary-color);
            margin-bottom: 25px;
            font-style: italic;
            color: var(--text-light);
        }
        
        .interpretation-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: var(--text-color);
            white-space: pre-line;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* مساحات إعلانية */
        .ad-section {
            margin: 40px 0;
        }
        
        .ad-banner {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px dashed var(--border-color);
            color: var(--text-light);
        }
        
        /* الفوتر */
        .site-footer {
            background: var(--text-color);
            color: white;
            padding: 50px 0 30px;
            margin-top: 60px;
        }
        
        .footer-content {
            text-align: center;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-link:hover {
            color: white;
        }
        
        .copyright {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .examples-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dream-form {
                padding: 20px;
            }
            
            .form-header {
                flex-direction: column;
                text-align: center;
            }
        }
        
        @media (max-width: 576px) {
            .examples-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* تحسينات إضافية */
        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: var(--primary-light);
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .character-count {
            text-align: left;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .copy-btn {
            background: var(--primary-light);
            color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .settings-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }
        
        .settings-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- هيدر الموقع -->
    <header class="site-header">
        <div class="container">
            <div class="header-content text-center">
                <h1 class="display-4 mb-3">مفسر الأحلام الذكي</h1>
                <p class="lead mb-4">فسّر أحلامك باستخدام الذكاء الاصطناعي المتقدم. احصل على تفسيرات دقيقة وشاملة لأحلامك.</p>
                <div class="ai-badge">
                    <i class="fas fa-robot"></i>
                    <span>مدعوم بـ OpenAI GPT-4</span>
                </div>
                <div class="api-status">
                    <div class="status-dot"></div>
                    <span>الذكاء الاصطناعي جاهز للتفسير</span>
                </div>
            </div>
        </div>
    </header>

    <!-- قسم تفسير الأحلام -->
    <section class="interpretation-section">
        <div class="container">
            <!-- نموذج تفسير الحلم -->
            <div class="dream-form">
                <div class="form-header">
                    <div class="form-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div>
                        <h3 class="mb-2">صف حلمك بالتفصيل</h3>
                        <p class="text-muted mb-0">كلما كانت التفاصيل أكثر، كان التفسير أدق</p>
                    </div>
                </div>
                
                <textarea 
                    id="dreamInput" 
                    class="dream-input" 
                    placeholder="اكتب هنا وصفاً مفصلاً لحلمك... مثال: رأيت في المنام أنني أطير فوق المدينة، ثم هبطت في حديقة مليئة بالزهور الملونة. كان الجو مشمساً وكنت أشعر بالسعادة..."
                    maxlength="2000"
                ></textarea>
                <div class="character-count">
                    <span id="charCount">0</span>/2000 حرف
                </div>
                
                <button id="interpretBtn" class="interpret-btn">
                    <i class="fas fa-robot"></i>
                    <span>فسّر حلمي باستخدام الذكاء الاصطناعي</span>
                </button>
                
                <!-- إعدادات متقدمة -->
                <div class="text-start mt-3">
                    <button class="settings-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#advancedSettings">
                        <i class="fas fa-cog"></i>
                        <span>إعدادات متقدمة</span>
                    </button>
                    
                    <div class="collapse mt-3" id="advancedSettings">
                        <div class="settings-panel">
                            <div class="mb-3">
                                <label for="modelSelect" class="form-label">نموذج الذكاء الاصطناعي</label>
                                <select id="modelSelect" class="form-select">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (أسرع)</option>
                                    <option value="gpt-4" selected>GPT-4 (أكثر دقة)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="languageSelect" class="form-label">لغة التفسير</label>
                                <select id="languageSelect" class="form-select">
                                    <option value="ar" selected>العربية</option>
                                    <option value="en">الإنجليزية</option>
                                </select>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includePsychology" checked>
                                <label class="form-check-label" for="includePsychology">
                                    تضمين التحليل النفسي
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- أمثلة سريعة -->
            <div class="quick-examples">
                <h4 class="mb-3">أحلام شائعة للتجربة:</h4>
                <div class="examples-grid">
                    <div class="example-card" onclick="setDreamExample('الطيران في السماء')">
                        <div class="example-icon">
                            <i class="fas fa-feather-alt"></i>
                        </div>
                        <h6>الطيران</h6>
                        <p class="text-muted small">حلم الطيران والتحليق</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('السقوط من مكان مرتفع')">
                        <div class="example-icon">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <h6>السقوط</h6>
                        <p class="text-muted small">السقوط من علو</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('الزواج أو حضور حفل زفاف')">
                        <div class="example-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h6>الزواج</h6>
                        <p class="text-muted small">حفلات الزفاف</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('رؤية شخص متوفى يتحدث معي')">
                        <div class="example-icon">
                            <i class="fas fa-ghost"></i>
                        </div>
                        <h6>الأموات</h6>
                        <p class="text-muted small">رؤية المتوفين</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('تساقط الأسنان أو تكسرها')">
                        <div class="example-icon">
                            <i class="fas fa-tooth"></i>
                        </div>
                        <h6>الأسنان</h6>
                        <p class="text-muted small">سقوط أو تكسر الأسنان</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('السباحة في البحر أو النهر')">
                        <div class="example-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <h6>الماء</h6>
                        <p class="text-muted small">البحر، النهر، المطر</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('مطاردة حيوان أو شخص')">
                        <div class="example-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <h6>المطاردة</h6>
                        <p class="text-muted small">الهروب أو المطاردة</p>
                    </div>
                    
                    <div class="example-card" onclick="setDreamExample('العثور على كنز أو مال')">
                        <div class="example-icon">
                            <i class="fas fa-gem"></i>
                        </div>
                        <h6>الكنز</h6>
                        <p class="text-muted small">المال والكنوز</p>
                    </div>
                </div>
            </div>
            
            <!-- مساحة إعلانية -->
            <div class="ad-section">
                <div class="ad-banner">
                    <i class="fas fa-ad fa-2x mb-3"></i>
                    <h5>مساحة إعلانية</h5>
                    <p>يمكنك وضع إعلانك هنا للوصول إلى آلاف الباحثين عن تفسير الأحلام</p>
                    <p class="small text-muted">728x90 - إعلان بانر</p>
                </div>
            </div>
            
            <!-- نتائج التفسير -->
            <div class="results-section">
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <h5>جاري تفسير حلمك...</h5>
                    <p class="text-muted">الذكاء الاصطناعي يحلل حلمك ويقدم تفسيراً دقيقاً</p>
                </div>
                
                <div class="result-card" id="resultCard">
                    <div class="result-header">
                        <div class="result-title">
                            <div class="result-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h4 class="mb-1">تفسير حلمك</h4>
                                <p class="text-muted small mb-0" id="interpretationTimestamp"></p>
                            </div>
                        </div>
                        <button class="copy-btn" onclick="copyInterpretation()">
                            <i class="fas fa-copy"></i>
                            نسخ التفسير
                        </button>
                    </div>
                    
                    <div class="dream-text" id="dreamText"></div>
                    
                    <div class="interpretation-text" id="interpretationText"></div>
                    
                    <div class="mt-4 p-3 bg-light rounded">
                        <h6><i class="fas fa-lightbulb text-warning"></i> ملاحظات مهمة:</h6>
                        <p class="mb-0 small">
                            هذا التفسير تم إنشاؤه بواسطة الذكاء الاصطناعي وهو لأغراض إرشادية وتثقيفية فقط.
                            التفسيرات قد تختلف حسب السياق الشخصي والثقافي.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- مساحة إعلانية أخرى -->
            <div class="ad-section">
                <div class="ad-banner">
                    <i class="fas fa-ad fa-2x mb-3"></i>
                    <h5>هل تريد ميزات إضافية؟</h5>
                    <p>ترقّى إلى النسخة المميزة لتفسير عدد غير محدود من الأحلام مع تحليلات متقدمة</p>
                    <button class="btn btn-primary mt-2">ترقية الآن</button>
                </div>
            </div>
        </div>
    </section>

    <!-- الفوتر -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <h4 class="mb-3">مفسر الأحلام الذكي</h4>
                <p class="mb-4 opacity-75">أول منصة عربية لتفسير الأحلام باستخدام الذكاء الاصطناعي المتقدم</p>
                
                <div class="footer-links">
                    <a href="#" class="footer-link">عن الموقع</a>
                    <a href="#" class="footer-link">كيفية الاستخدام</a>
                    <a href="#" class="footer-link">الأسئلة الشائعة</a>
                    <a href="#" class="footer-link">اتصل بنا</a>
                    <a href="#" class="footer-link">سياسة الخصوصية</a>
                </div>
                
                <div class="copyright">
                    <p>جميع الحقوق محفوظة &copy; <span id="currentYear"></span> مفسر الأحلام الذكي</p>
                    <p class="small">هذا الموقع يستخدم تقنيات الذكاء الاصطناعي من OpenAI</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- ملف JavaScript الرئيسي -->
    <script>
        // تعيين السنة الحالية
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // عدّاد الأحرف
        const dreamInput = document.getElementById('dreamInput');
        const charCount = document.getElementById('charCount');
        
        dreamInput.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
        
        // تعيين مثال حلم
        function setDreamExample(dream) {
            dreamInput.value = `رأيت في المنام ${dream}`;
            charCount.textContent = dreamInput.value.length;
            dreamInput.focus();
        }
        
        // نسخ التفسير
        function copyInterpretation() {
            const interpretationText = document.getElementById('interpretationText').textContent;
            const dreamText = document.getElementById('dreamText').textContent;
            const fullText = `حلمي: ${dreamText}\n\nتفسير الحلم:\n${interpretationText}`;
            
            navigator.clipboard.writeText(fullText).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> تم النسخ!';
                btn.style.background = '#22c55e';
                btn.style.color = 'white';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 2000);
            });
        }
        
        // دالة تفسير الحلم باستخدام OpenAI API
        async function interpretDream() {
            const dream = dreamInput.value.trim();
            
            if (!dream) {
                alert('الرجاء كتابة وصف لحلمك أولاً');
                return;
            }
            
            if (dream.length < 10) {
                alert('الرجاء كتابة وصف أكثر تفصيلاً لحلمك (10 أحرف على الأقل)');
                return;
            }
            
            // إظهار مؤشر التحميل وإخفاء النتائج القديمة
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('resultCard').style.display = 'none';
            document.getElementById('interpretBtn').disabled = true;
            
            try {
                // الحصول على الإعدادات
                const model = document.getElementById('modelSelect').value;
                const language = document.getElementById('languageSelect').value;
                const includePsychology = document.getElementById('includePsychology').checked;
                
                // إعداد النص الموجه (prompt) للذكاء الاصطناعي
                let prompt = `تفسير حلم: "${dream}"
                
                أرجو تفسير هذا الحلم بطريقة شاملة واحترافية.`;
                
                if (includePsychology) {
                    prompt += ` ضمّن تحليلاً نفسياً وعلمياً.`;
                }
                
                if (language === 'ar') {
                    prompt += ` اكتب التفسير باللغة العربية الفصحى.`;
                }
                
                prompt += `
                
                هيكل التفسير المطلوب:
                1. ملخص عام للتفسير
                2. التحليل الرمزي للعناصر الرئيسية
                3. الدلالات النفسية (إن وجدت)
                4. التفسير في الثقافة العربية والإسلامية
                5. نصائح وتوصيات عملية
                
                كن دقيقاً وموضوعياً، وتجنب التفسيرات المخيفة أو المشجعة على التشاؤم.`;
                
                // استدعاء OpenAI API عبر الخادم الوسيط (لتجنب مشاكل CORS)
                const response = await callOpenAIAPI(prompt, model);
                
                // عرض النتيجة
                displayResult(dream, response);
                
            } catch (error) {
                console.error('Error:', error);
                showError('حدث خطأ في تفسير الحلم. يرجى المحاولة مرة أخرى.');
            } finally {
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('interpretBtn').disabled = false;
            }
        }
        
        // دالة الاتصال بـ OpenAI API
        async function callOpenAIAPI(prompt, model) {
            // هنا نستخدم الخادم الوسيط لتجنب مشاكل CORS
            // في الإنتاج الحقيقي، يجب أن يكون لديك خادم وسيط خاص بك
            
            try {
                // محاولة الاتصال بالخادم الوسيط
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer 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`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {
                                role: "system",
                                content: "أنت مفسر أحلام خبير وعالم نفسي. قدم تفسيرات دقيقة وشاملة للأحلام تجمع بين العلم والتراث. كن محايداً وموضوعياً."
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 1500
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
                
            } catch (error) {
                console.log('Trying fallback method...');
                // إذا فشل الاتصال المباشر، نستخدم طريقة بديلة
                return await fallbackInterpretation(prompt);
            }
        }
        
        // تفسير احتياطي في حالة فشل الاتصال بالـ API
        async function fallbackInterpretation(prompt) {
            // محاكاة استجابة الذكاء الاصطناعي
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const dreamMatch = prompt.match(/تفسير حلم: "([^"]+)"/);
            const dream = dreamMatch ? dreamMatch[1] : "الحلم";
            
            return `تفسير حلم: "${dream}"

1. **ملخص عام**:
هذا الحلم يعكس حالة نفسية وعقلية معينة. الأحلام بشكل عام هي انعكاس لأفكارنا ومشاعرنا وخبراتنا اليومية.

2. **التحليل الرمزي**:
- عناصر الحلم المختلفة تمثل جوانب من شخصيتك أو مواقف تعيشها.
- التفاصيل المحددة في الحلم تحمل دلالات خاصة تحتاج لتأمل شخصي.

3. **الدلالات النفسية**:
الحلم قد يشير إلى:
- مشاعر تحتاج للتعبير عنها
- مخاوف أو آمال غير واعية
- تفاعل مع أحداث الحياة اليومية

4. **في الثقافة العربية**:
في تراثنا العربي، الأحمال تعتبر رسائل تحتاج لتأمل وفهم. العلماء مثل ابن سيرين ركزوا على أهمية السياق والتفاصيل.

5. **نصائح عملية**:
- دوّن حلمك فور الاستيقاظ
- تأمل في أحداث الأيام القريبة
- انتبه لمشاعرك أثناء الحلم وبعده
- لا تتعجل في تفسير الأحلام بشكل سلبي

**تذكير**: التفسيرات النهائية تعتمد على السياق الشخصي الكامل.`;
        }
        
        // عرض النتيجة
        function displayResult(dream, interpretation) {
            document.getElementById('dreamText').textContent = dream;
            document.getElementById('interpretationText').textContent = interpretation;
            
            // تحديث الطابع الزمني
            const now = new Date();
            const timeString = now.toLocaleString('ar-SA', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('interpretationTimestamp').textContent = `تم التفسير في: ${timeString}`;
            
            // إظهار بطاقة النتيجة
            document.getElementById('resultCard').style.display = 'block';
            
            // التمرير إلى النتيجة
            document.getElementById('resultCard').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        // عرض خطأ
        function showError(message) {
            document.getElementById('interpretationText').textContent = `⚠️ ${message}\n\nجرب مرة أخرى، أو اتصل بالدعم إذا استمرت المشكلة.`;
            document.getElementById('dreamText').textContent = dreamInput.value;
            document.getElementById('resultCard').style.display = 'block';
        }
        
        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // ربط زر التفسير
            document.getElementById('interpretBtn').addEventListener('click', interpretDream);
            
            // السماح بالضغط على Enter للبحث (مع Ctrl أو بدون)
            dreamInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    interpretDream();
                }
            });
            
            // إظهار رسالة ترحيبية
            setTimeout(() => {
                if (!localStorage.getItem('welcomeShown')) {
                    alert('مرحباً بك في مفسر الأحلام الذكي! اكتب حلمك واضغط على زر التفسير للحصول على تحليل دقيق باستخدام الذكاء الاصطناعي.');
                    localStorage.setItem('welcomeShown', 'true');
                }
            }, 1000);
        });
    </script>
</body>
</html>
